<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Warehouse</title>

<style>
body {
    margin: 0;
    font-family: Arial;
}

.header {
    background: #1f5f99;
    color: white;
    padding: 15px;
    font-size: 22px;
}

.container {
    display: flex;
}

.sidebar {
    width: 300px;
    padding: 15px;
    border-right: 1px solid #ccc;
}

.main {
    flex: 1;
    padding: 15px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}

.complete {
    background: #90ee90;
}

.over {
    background: #ff9999;
}

button {
    margin-top: 10px;
    padding: 8px;
}
</style>

</head>

<body>

<div class="header">
    Haier
</div>

<div class="container">

    <!-- LEFT -->
    <div class="sidebar">

        <h3>Select Warehouse</h3>
        <select id="warehouseSelect">
            <option value="{{warehouse}}">{{warehouse}}</option>
        </select>

        <h3>Original Model Code</h3>
        <input type="text" id="barcodeInput" autofocus style="width:100%; padding:8px;">

        <h3>Model Code (9 digit)</h3>
        <input type="text" id="modelCode" readonly style="width:100%; padding:8px;">

        <h3>Select Location</h3>
        <input type="text" id="locationInput" value="{{warehouse}}" readonly style="width:100%; padding:8px;">

        <br>

        <button>Import</button>
        <button>Export Excel</button>

    </div>

    <!-- RIGHT -->
    <div class="main">

        <table>
            <thead>
                <tr>
                    <th>NO.</th>
                    <th>Location</th>
                    <th>Model Code</th>
                    <th>Description</th>
                    <th>Inv.Qty</th>
                    <th>Act.Qty</th>
                </tr>
            </thead>

            <tbody>
                {% for row in rows %}
                <tr>
                    <td>{{loop.index}}</td>
                    <td>{{row[0]}}</td>
                    <td>{{row[1]}}</td>
                    <td>{{row[2]}}</td>
                    <td class="inv">{{row[3]}}</td>
                    <td class="act">{{row[4]}}</td>
                </tr>
                {% endfor %}
            </tbody>

        </table>

    </div>

</div>

<script>

const barcodeInput = document.getElementById("barcodeInput");
const modelCodeInput = document.getElementById("modelCode");

barcodeInput.addEventListener("keypress", function(e){

    if(e.key === "Enter"){

        let fullCode = barcodeInput.value.trim();
        if(!fullCode) return;

        // ðŸ”¥ à¹ƒà¸Šà¹‰à¸•à¸£à¸‡ (à¹„à¸¡à¹ˆà¸•à¸±à¸”)
        let modelCode = fullCode;

        modelCodeInput.value = modelCode;

        let location = document.getElementById("locationInput").value;

        if(!location){
            alert("âŒ à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸ Location");
            return;
        }

        fetch("/scan", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                model_code: modelCode,
                location: location
            })
        })
        .then(res => res.json())
        .then(data => {

            if(data.status === "duplicate"){
                alert(data.message);
            }

            else if(data.status === "success"){

                let rows = document.querySelectorAll("tbody tr");

                rows.forEach(row => {

                    let modelCell = row.children[2]; // ðŸ”¥ à¸ªà¸³à¸„à¸±à¸
                    let actCell = row.querySelector(".act");
                    let invCell = row.querySelector(".inv");

                    if(modelCell.innerText.trim() === modelCode){

                        let act = parseInt(actCell.innerText) || 0;
                        let inv = parseInt(invCell.innerText) || 0;

                        act++;
                        actCell.innerText = act;

                        row.classList.remove("complete","over");

                        if(act === inv) row.classList.add("complete");
                        if(act > inv) row.classList.add("over");
                    }
                });
            }

            else{
                alert(data.message);
            }

            barcodeInput.value="";
            barcodeInput.focus();
        });
    }
});

</script>

</body>
</html>
